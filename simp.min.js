(function(){let a=[];var b=function(a,c){function d(a,b,c){a.addEventListener(b,c),t[a]||(t[a]={}),t[a][b]=c}function e(a){t[a]&&Object.keys(t[a]).forEach(b=>{a.removeEventListener(b,t[a][b])}),t={}}function f(a){let b=document.createElement("div");return b.innerHTML=a,b.firstChild}function g(a){let b=Object.assign({},a.storage),c={general:[],customs:[]},d={list:c,add:function(a,b="general"){c[b].push(a)},clear:function(a="general"){c[a]=[]},fire:function(a,b="general"){c[b].forEach(b=>b(a))}},e=function(){return b};e.__proto__={set:a=>{Object.assign(b,a),d.fire(a),d.fire(a,"customs")},callbacks:d},a.storage=e}function h(a){p=u.length;let b=Object.assign({},a);g(b),u.push(b)}function i(){u.filter(a=>a!=j()&&a.visible).forEach(a=>{a.markup=a.DOMElement.outerHTML,a.DOMElement.remove(),a.visible=!1})}function j(){return u[p]}function k(a=1){let b=Math.max(0,p-Math.max(Math.abs(a),1));return u[b]}function l(){let a=j(),b=a.DOMElement.querySelectorAll(`input, div[contenteditable='true']`);a.storage.callbacks.clear(),b.forEach((b,c)=>{let f=b.getAttribute("data-simp-id"),g="DIV"==b.tagName;f?Object.keys(a.storage()).includes(f)?g?b.innerHTML=a.storage()[f]:b.value=a.storage()[f]:a.storage()[f]=g?b.innerHTML:b.value:(f=`input${c}`,b.setAttribute("data-simp-id",f),a.storage()[f]=g?b.innerHTML:b.value),e(b),d(b,"keyup",()=>{let c=g?b.innerHTML:b.value;a.storage()[f]=c;let d={};d[f]=c,a.storage.callbacks.fire(d,"customs")});let h=({currentTarget:b})=>{setTimeout(()=>{a.storage()[f]=b.value},50)};d(b,"cut",h),d(b,"paste",h),a.storage.callbacks.add(a=>{f in a&&(g?b.innerHTML=a[f]:b.value=a[f])})})}function m(a){i();let b=j(),c=r.appendChild(f(b.markup));b.visible=!0,b.DOMElement=c,Object.assign(b.storage(),a),l(),b.creationCallback.call(q),s&&s(b)}function n(a=1){if(0!=p){for(0>p-a&&(a=p);0<a;)p-=1,i(),u.pop(),a--;m()}}function o(a=0){return u[p-Math.min(p,Math.abs(a))].storage()}if(!(this instanceof b))return new b(a,c);let p,q,r=document.querySelector(a||"body"),s=c,t={},u=[];return q={open:function(a,b){h(a),m(b)},find:function(a){return j().DOMElement.querySelector(a)},findAll:function(a){return j().DOMElement.querySelectorAll(a)},click:function(a,b){j().DOMElement.querySelector(a).onclick=b},storage:o,set:function(a){j().storage.set(a)},fetch:function(){return u.reduce((a,b)=>(Object.keys(b.storage()).forEach(c=>{a[c]=b.storage()[c]}),a),{})},current:j,prev:k,back:n,rebind:l,subscribe:function(a,b){j().storage.callbacks.add(c=>{b&&b in c?a(c[b]):a(c)},"customs")},tree:()=>u},q};b.__proto__={component:function(b,c,d={}){let e={selector:b,storage:Object.assign({},d),creationCallback:c,markup:document.querySelector(b).outerHTML};return document.querySelector(b).style.display="none",a.push(e),e},componentsList:()=>a},window.simp=b})();